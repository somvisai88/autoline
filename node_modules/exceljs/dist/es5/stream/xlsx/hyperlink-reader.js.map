{"version":3,"sources":["../../../../lib/stream/xlsx/hyperlink-reader.js"],"names":["require","EventEmitter","SAXStream","Enums","RelType","HyperlinkReader","workbook","id","_workbook","fn","hyperlinks","forEach","entry","options","emitHyperlinks","autodrain","emit","saxStream","sax","on","node","name","rId","attributes","Id","Type","Hyperlink","relationship","type","RelationshipType","Styles","target","Target","targetMode","TargetMode","flowControl","createChild","pipe","sync","length","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;eAAuBA,OAAO,CAAC,QAAD,C;IAAvBC,Y,YAAAA,Y;;AACP,IAAMC,SAAS,GAAGF,OAAO,CAAC,wBAAD,CAAzB;;AAEA,IAAMG,KAAK,GAAGH,OAAO,CAAC,iBAAD,CAArB;;AACA,IAAMI,OAAO,GAAGJ,OAAO,CAAC,qBAAD,CAAvB;;IAEMK,e;;;;;AACJ,2BAAYC,QAAZ,EAAsBC,EAAtB,EAA0B;AAAA;;AAAA;;AACxB,0FADwB,CAGxB;;AACA,UAAKA,EAAL,GAAUA,EAAV;AAEA,UAAKC,SAAL,GAAiBF,QAAjB;AANwB;AAOzB;;;;yBAMIG,E,EAAI;AACP,aAAO,KAAKC,UAAL,CAAgBC,OAAhB,CAAwBF,EAAxB,CAAP;AACD;;;yBAEIG,K,EAAOC,O,EAAS;AAAA;;AACnB,UAAIC,cAAc,GAAG,KAArB;AACA,UAAIJ,UAAU,GAAG,IAAjB;;AACA,cAAQG,OAAO,CAACH,UAAhB;AACE,aAAK,MAAL;AACEI,UAAAA,cAAc,GAAG,IAAjB;AACA;;AACF,aAAK,OAAL;AACE,eAAKJ,UAAL,GAAkBA,UAAU,GAAG,EAA/B;AACA;;AACF;AACE;AARJ;;AAWA,UAAI,CAACI,cAAD,IAAmB,CAACJ,UAAxB,EAAoC;AAClCE,QAAAA,KAAK,CAACG,SAAN;AACA,aAAKC,IAAL,CAAU,UAAV;AACA;AACD;;AAED,UAAMC,SAAS,GAAG,IAAIf,SAAJ,EAAlB;AACAe,MAAAA,SAAS,CAACC,GAAV,CAAcC,EAAd,CAAiB,SAAjB,EAA4B,UAAAC,IAAI,EAAI;AAClC,YAAIA,IAAI,CAACC,IAAL,KAAc,cAAlB,EAAkC;AAChC,cAAMC,GAAG,GAAGF,IAAI,CAACG,UAAL,CAAgBC,EAA5B;;AACA,kBAAQJ,IAAI,CAACG,UAAL,CAAgBE,IAAxB;AACE,iBAAKrB,OAAO,CAACsB,SAAb;AACE;AACE,oBAAMC,YAAY,GAAG;AACnBC,kBAAAA,IAAI,EAAEzB,KAAK,CAAC0B,gBAAN,CAAuBC,MADV;AAEnBR,kBAAAA,GAAG,EAAHA,GAFmB;AAGnBS,kBAAAA,MAAM,EAAEX,IAAI,CAACG,UAAL,CAAgBS,MAHL;AAInBC,kBAAAA,UAAU,EAAEb,IAAI,CAACG,UAAL,CAAgBW;AAJT,iBAArB;;AAMA,oBAAIpB,cAAJ,EAAoB;AAClB,kBAAA,MAAI,CAACE,IAAL,CAAU,WAAV,EAAuBW,YAAvB;AACD,iBAFD,MAEO;AACLjB,kBAAAA,UAAU,CAACiB,YAAY,CAACL,GAAd,CAAV,GAA+BK,YAA/B;AACD;AACF;AACD;;AAEF;AACE;AAlBJ;AAoBD;AACF,OAxBD;AA0BAV,MAAAA,SAAS,CAACC,GAAV,CAAcC,EAAd,CAAiB,KAAjB,EAAwB,YAAM;AAC5B,QAAA,MAAI,CAACH,IAAL,CAAU,UAAV;AACD,OAFD,EA/CmB,CAmDnB;;AACA,UAAMmB,WAAW,GAAG,KAAK3B,SAAL,CAAe2B,WAAf,CAA2BC,WAA3B,EAApB;;AACAD,MAAAA,WAAW,CAACE,IAAZ,CAAiBpB,SAAjB,EAA4B;AAACqB,QAAAA,IAAI,EAAE;AAAP,OAA5B;AACA1B,MAAAA,KAAK,CAACyB,IAAN,CAAWF,WAAX;AACD;;;wBA/DW;AACV,aAAQ,KAAKzB,UAAL,IAAmB,KAAKA,UAAL,CAAgB6B,MAApC,IAA+C,CAAtD;AACD;;;;EAZ2BtC,Y;;AA4E9BuC,MAAM,CAACC,OAAP,GAAiBpC,eAAjB","sourcesContent":["const {EventEmitter} = require('events');\r\nconst SAXStream = require('../../utils/sax-stream');\r\n\r\nconst Enums = require('../../doc/enums');\r\nconst RelType = require('../../xlsx/rel-type');\r\n\r\nclass HyperlinkReader extends EventEmitter {\r\n  constructor(workbook, id) {\r\n    super();\r\n\r\n    // in a workbook, each sheet will have a number\r\n    this.id = id;\r\n\r\n    this._workbook = workbook;\r\n  }\r\n\r\n  get count() {\r\n    return (this.hyperlinks && this.hyperlinks.length) || 0;\r\n  }\r\n\r\n  each(fn) {\r\n    return this.hyperlinks.forEach(fn);\r\n  }\r\n\r\n  read(entry, options) {\r\n    let emitHyperlinks = false;\r\n    let hyperlinks = null;\r\n    switch (options.hyperlinks) {\r\n      case 'emit':\r\n        emitHyperlinks = true;\r\n        break;\r\n      case 'cache':\r\n        this.hyperlinks = hyperlinks = {};\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    if (!emitHyperlinks && !hyperlinks) {\r\n      entry.autodrain();\r\n      this.emit('finished');\r\n      return;\r\n    }\r\n\r\n    const saxStream = new SAXStream();\r\n    saxStream.sax.on('opentag', node => {\r\n      if (node.name === 'Relationship') {\r\n        const rId = node.attributes.Id;\r\n        switch (node.attributes.Type) {\r\n          case RelType.Hyperlink:\r\n            {\r\n              const relationship = {\r\n                type: Enums.RelationshipType.Styles,\r\n                rId,\r\n                target: node.attributes.Target,\r\n                targetMode: node.attributes.TargetMode,\r\n              };\r\n              if (emitHyperlinks) {\r\n                this.emit('hyperlink', relationship);\r\n              } else {\r\n                hyperlinks[relationship.rId] = relationship;\r\n              }\r\n            }\r\n            break;\r\n\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n    });\r\n\r\n    saxStream.sax.on('end', () => {\r\n      this.emit('finished');\r\n    });\r\n\r\n    // create a down-stream flow-control to regulate the stream\r\n    const flowControl = this._workbook.flowControl.createChild();\r\n    flowControl.pipe(saxStream, {sync: true});\r\n    entry.pipe(flowControl);\r\n  }\r\n}\r\n\r\nmodule.exports = HyperlinkReader;\r\n"],"file":"hyperlink-reader.js"}